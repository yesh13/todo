<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.ActivityMapper">

<resultMap id="aidRM" type="domain.ActivityId">
  <constructor>
    <arg column="aid" javaType="int"/>
  </constructor>
</resultMap>
<resultMap id="parentRM" type="domain.ActivityId">
  <constructor>
    <arg column="parent" javaType="int"/>
  </constructor>
</resultMap>

<resultMap id="actResultMap" type="domain.Activity">
  <constructor>
    <arg javaType="domain.ActivityId" resultMap="aidRM"/>
  </constructor>
  <result property="name" column="name"/>
  <association property="note" javaType="domain.Note">
    <result property="note" column="note"/>
  </association>
  <association property="location" javaType="domain.Location">
    <result property="place" column="location"/>
  </association>
  <association property="parent" resultMap="parentRM"/>
</resultMap>
<resultMap id="actBriefResultMap" type="domain.Activity">
  <constructor>
    <arg javaType="domain.ActivityId" resultMap="aidRM"/>
  </constructor>
  <result property="name" column="name"/>
  <association property="location" javaType="domain.Location">
    <result property="place" column="location"/>
  </association>
  <association property="parent" resultMap="parentRM"/>
</resultMap>
<resultMap id="actSetResultMap" type="domain.ActivitySet">
<collection property="realList" ofType="domain.Activity" resultMap="actBriefResultMap"/>
</resultMap>

	<select id="getById" resultType="domain.Activity" resultMap="actResultMap">
		select * from activity where aid = #{aid} and uid=#{uid}
	</select>
	<select id="getRealChildById" resultMap="actResultMap">
		select aid,parent,name,location from activity where parent = #{aid} and uid=#{uid}
	</select>
	
	<insert id="addActivity" parameterType="map">
		insert into Activity (uid,name,parent,note,location)
		values (#{uid},#{name},#{parent},#{note},#{location})
	</insert>

	<update id="updateActivity">
		update Activity set
		uid = #{uid},
		name = #{name},
		parent = #{parent},
		note = #{note},
		location = #{location}
		where aid = #{aid}
	</update>

	<delete id="deleteActivity">
		delete from Activity where aid = #{aid}
	</delete>
</mapper>